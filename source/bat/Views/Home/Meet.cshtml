
@{
    ViewBag.Title = "Meet";
}

<h2>Meet - Publisher</h2>

<!-- TokBox API  -->
<script src="https://static.opentok.com/v2/js/opentok.min.js"></script> 

<!-- Test TokBox  -->
<script>
    var apiKey = "45496652"; //API Key

    //These are manually generated session id and token. Production requires Sessions and tokens be generated by server.  
    var sessionId = "2_MX40NTQ5NjY1Mn5-MTQ1NTc1NjMwMzczMH5OeitjZklmeVQzU1o1ZlVrdSt1SzZqbzJ-UH4";

    //Publisher Token
    var token = "T1==cGFydG5lcl9pZD00NTQ5NjY1MiZzaWc9YzNiMDA0NDdkMGRkOWQ0NzQzMzBkODg5ZTgwZTRmOGZmYmVlYzYyMjpyb2xlPXB1Ymxpc2hlciZzZXNzaW9uX2lkPTJfTVg0ME5UUTVOalkxTW41LU1UUTFOVGMxTmpNd016Y3pNSDVPZWl0alprbG1lVlF6VTFvMVpsVnJkU3QxU3pacWJ6Si1VSDQmY3JlYXRlX3RpbWU9MTQ1NTc1NjM0NiZub25jZT0wLjUxNzUzNjg4MjE4Njc1NTYmZXhwaXJlX3RpbWU9MTQ1NTg0MjY1OCZjb25uZWN0aW9uX2RhdGE9";

    var session = OT.initSession(apiKey, sessionId);

    //Logs when someone joins and disconnects
    var connectionCount = 0;
    session.on({
        connectionCreated: function (event) {
            connectionCount++;
            if (event.connection.connectionId != session.connection.connectionId) {
                console.log('Another client connected. ' + connectionCount + ' total.');
            }
        },
        connectionDestroyed: function connectionDestroyedHandler(event) {
            connectionCount--;
            console.log('A client disconnected. ' + connectionCount + ' total.');
        }
    });

    session.connect(token, function (error) {
        if (error) {
            if (error.code === 1006) {
                alert('Failed to connect. Please check your connection and try connecting again.');
            } else {
                alert('An unknown error occurred connecting. Please try again later.');
            }
        } else {
            session.publish();
        }
    });
    session.on("streamCreated", function (event) {
        session.subscribe(event.stream);
    });
</script>
