
@{
    ViewBag.Title = "Meet";
}

<h2>Meet - Publisher</h2>

<!-- TokBox API  -->
<script src="https://static.opentok.com/v2/js/opentok.min.js"></script> 

<!-- Test TokBox  -->
<script>
    var apiKey = "45496652"; //API Key

    //These are manually generated session id and token. Production requires Sessions and tokens be generated by server.  
    var sessionId = "1_MX40NTQ5NjY1Mn5-MTQ1NjAwOTE2Mzk1OH5rdWY0MVd6elRvaENXc010UHh4cnc4U2p-UH4";

    //Publisher Token
    var token = "T1==cGFydG5lcl9pZD00NTQ5NjY1MiZzaWc9MDdlMTk0ODgwOGIxZTg1Yzc3OTU5NjhjM2YxNDMwYzg4ODg5NWQ1ZDpyb2xlPXB1Ymxpc2hlciZzZXNzaW9uX2lkPTFfTVg0ME5UUTVOalkxTW41LU1UUTFOakF3T1RFMk16azFPSDVyZFdZME1WZDZlbFJ2YUVOWGMwMTBVSGg0Y25jNFUycC1VSDQmY3JlYXRlX3RpbWU9MTQ1NjAwOTIxMSZub25jZT0wLjEwMjYwMDM5NzUxMzE4MTI5JmV4cGlyZV90aW1lPTE0NTg2MDA5ODcmY29ubmVjdGlvbl9kYXRhPQ==";

    var session = OT.initSession(apiKey, sessionId);

    //Logs when someone joins and disconnects
    var connectionCount = 0;
    session.on({
        connectionCreated: function (event) {
            connectionCount++;
            if (event.connection.connectionId != session.connection.connectionId) {
                console.log('Another client connected. ' + connectionCount + ' total.');
            }
        },
        connectionDestroyed: function connectionDestroyedHandler(event) {
            connectionCount--;
            console.log('A client disconnected. ' + connectionCount + ' total.');
        }
    });

    session.connect(token, function (error) {
        if (error) {
            if (error.code === 1006) {
                alert('Failed to connect. Please check your connection and try connecting again.');
            } else {
                alert('An unknown error occurred connecting. Please try again later.');
            }
        } else {
            session.publish();
        }
    });
    session.on("streamCreated", function (event) {
        session.subscribe(event.stream);
    });
</script>
