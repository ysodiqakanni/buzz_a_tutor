@model bat.logic.Models.Meet
@{
    ViewBag.Title = "Meet";
}

<h2>@Model.other.Fname @Model.other.Lname</h2>

<!-- TokBox API  -->
<script src="https://static.opentok.com/v2/js/opentok.min.js"></script> 

<!-- Test TokBox  -->
<script>
    var apiKey = "45496652"; //API Key

    //These are manually generated session id and token. Production requires Sessions and tokens be generated by server.  
    var sessionId = "@Model.session";

    //Publisher Token
    var token = "@Model.token";

    var session = OT.initSession(apiKey, sessionId);

    //Logs when someone joins and disconnects
    var connectionCount = 0;
    session.on({
        connectionCreated: function (event) {
            connectionCount++;
            if (event.connection.connectionId != session.connection.connectionId) {
                console.log('Another client connected. ' + connectionCount + ' total.');
            }
        },
        connectionDestroyed: function connectionDestroyedHandler(event) {
            connectionCount--;
            console.log('A client disconnected. ' + connectionCount + ' total.');
        }
    });

    session.connect(token, function (error) {
        if (error) {
            if (error.code === 1006) {
                alert('Failed to connect. Please check your connection and try connecting again.');
            } else {
                alert('An unknown error occurred connecting. Please try again later.');
            }
        } else {
            session.publish();
        }
    });
    session.on("streamCreated", function (event) {
        session.subscribe(event.stream);
    });
</script>
